<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CO2-Aware Shopping Assistant - UI Tests</title>
    <style>
        /* Test-specific styles */
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .test-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .product-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .product-image {
            width: 100%;
            height: 150px;
            background: #f0f0f0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            margin-bottom: 10px;
        }
        
        .product-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .product-price {
            color: #007bff;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .product-co2 {
            color: #28a745;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .product-eco-score {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .product-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>CO2-Aware Shopping Assistant - UI Tests</h1>
        
        <div class="test-section">
            <h2 class="test-title">Test Results</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">Product Display Test</h2>
            <div id="product-display-test"></div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">CO2 Impact Analysis Test</h2>
            <div id="co2-analysis-test"></div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">User Interaction Test</h2>
            <div id="interaction-test"></div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">Sample Product Data</h2>
            <div id="sample-products"></div>
        </div>
    </div>
    
    <script>
        // Test framework
        class UITestFramework {
            constructor() {
                this.tests = [];
                this.results = [];
            }
            
            test(name, testFunction) {
                this.tests.push({ name, testFunction });
            }
            
            async runTests() {
                const resultsDiv = document.getElementById('test-results');
                resultsDiv.innerHTML = '<h3>Running Tests...</h3>';
                
                for (const test of this.tests) {
                    try {
                        const result = await test.testFunction();
                        this.results.push({ name: test.name, passed: result, error: null });
                    } catch (error) {
                        this.results.push({ name: test.name, passed: false, error: error.message });
                    }
                }
                
                this.displayResults();
            }
            
            displayResults() {
                const resultsDiv = document.getElementById('test-results');
                let html = '<h3>Test Results</h3>';
                
                this.results.forEach(result => {
                    const className = result.passed ? 'test-pass' : 'test-fail';
                    const status = result.passed ? 'PASS' : 'FAIL';
                    html += `<div class="test-result ${className}">${status}: ${result.name}</div>`;
                    if (result.error) {
                        html += `<div class="test-info">Error: ${result.error}</div>`;
                    }
                });
                
                const passed = this.results.filter(r => r.passed).length;
                const total = this.results.length;
                html += `<div class="test-info">Summary: ${passed}/${total} tests passed</div>`;
                
                resultsDiv.innerHTML = html;
            }
            
            assert(condition, message) {
                if (!condition) {
                    throw new Error(message || 'Assertion failed');
                }
            }
            
            assertEqual(actual, expected, message) {
                if (actual !== expected) {
                    throw new Error(message || `Expected ${expected}, got ${actual}`);
                }
            }
            
            assertContains(text, substring, message) {
                if (!text.includes(substring)) {
                    throw new Error(message || `Expected "${text}" to contain "${substring}"`);
                }
            }
        }
        
        // Initialize test framework
        const testFramework = new UITestFramework();
        
        // Sample product data from your response
        const sampleProductData = {
            "products": [
                {
                    "name": "Sunglasses",
                    "price": "$19.99",
                    "co2_emissions": "49.0kg (Medium)",
                    "eco_score": "9/10",
                    "description": "Add a modern touch to your outfits with these sleek aviator sunglasses.",
                    "image_url": "/ob-images/static/img/products/sunglasses.jpg"
                },
                {
                    "name": "Tank Top",
                    "price": "$18.99",
                    "co2_emissions": "49.1kg (Medium)",
                    "eco_score": "9/10",
                    "description": "Perfectly cropped cotton tank, with a scooped neckline.",
                    "image_url": "/ob-images/static/img/products/tank-top.jpg"
                },
                {
                    "name": "Watch",
                    "price": "$109.99",
                    "co2_emissions": "44.5kg (Medium)",
                    "eco_score": "8/10",
                    "description": "This gold-tone stainless steel watch will work with most of your outfits.",
                    "image_url": "/ob-images/static/img/products/watch.jpg"
                },
                {
                    "name": "Loafers",
                    "price": "$89.99",
                    "co2_emissions": "45.5kg (Medium)",
                    "eco_score": "9/10",
                    "description": "A neat addition to your summer wardrobe.",
                    "image_url": "/ob-images/static/img/products/loafers.jpg"
                },
                {
                    "name": "Hairdryer",
                    "price": "$24.99",
                    "co2_emissions": "48.8kg (Medium)",
                    "eco_score": "9/10",
                    "description": "This lightweight hairdryer has 3 heat and speed settings. It's perfect for travel.",
                    "image_url": "/ob-images/static/img/products/hairdryer.jpg"
                },
                {
                    "name": "Candle Holder",
                    "price": "$18.99",
                    "co2_emissions": "49.1kg (Medium)",
                    "eco_score": "9/10",
                    "description": "This small but intricate candle holder is an excellent gift.",
                    "image_url": "/ob-images/static/img/products/candle-holder.jpg"
                },
                {
                    "name": "Salt & Pepper Shakers",
                    "price": "$18.49",
                    "co2_emissions": "49.1kg (Medium)",
                    "eco_score": "9/10",
                    "description": "Add some flavor to your kitchen.",
                    "image_url": "/ob-images/static/img/products/salt-and-pepper-shakers.jpg"
                },
                {
                    "name": "Bamboo Glass Jar",
                    "price": "$5.49",
                    "co2_emissions": "49.7kg (Medium)",
                    "eco_score": "9/10",
                    "description": "This bamboo glass jar can hold 57 oz (1.7 l) and is perfect for any kitchen.",
                    "image_url": "/ob-images/static/img/products/bamboo-glass-jar.jpg"
                },
                {
                    "name": "Mug",
                    "price": "$8.99",
                    "co2_emissions": "49.6kg (Medium)",
                    "eco_score": "9/10",
                    "description": "A simple mug with a mustard interior.",
                    "image_url": "/ob-images/static/img/products/mug.jpg"
                }
            ],
            "message": "🌱 Found 9 eco-friendly products for you. Here they are:"
        };
        
        // Test 1: Product Data Parsing
        testFramework.test('Product Data Parsing', () => {
            testFramework.assert(sampleProductData.products, 'Products array should exist');
            testFramework.assert(sampleProductData.products.length > 0, 'Products array should not be empty');
            testFramework.assert(sampleProductData.message, 'Message should exist');
            
            const firstProduct = sampleProductData.products[0];
            testFramework.assert(firstProduct.name, 'Product should have a name');
            testFramework.assert(firstProduct.price, 'Product should have a price');
            testFramework.assert(firstProduct.co2_emissions, 'Product should have CO2 emissions data');
            testFramework.assert(firstProduct.eco_score, 'Product should have an eco score');
            
            return true;
        });
        
        // Test 2: CO2 Emissions Parsing
        testFramework.test('CO2 Emissions Parsing', () => {
            const co2Data = sampleProductData.products[0].co2_emissions;
            testFramework.assertContains(co2Data, 'kg', 'CO2 data should contain kg');
            testFramework.assertContains(co2Data, 'Medium', 'CO2 data should contain impact level');
            
            // Test CO2 extraction regex
            const co2Match = co2Data.match(/(\d+(?:\.\d+)?)\s*kg/i);
            testFramework.assert(co2Match, 'Should be able to extract CO2 amount');
            testFramework.assertEqual(parseFloat(co2Match[1]), 49.0, 'Should extract correct CO2 amount');
            
            return true;
        });
        
        // Test 3: Eco Score Validation
        testFramework.test('Eco Score Validation', () => {
            sampleProductData.products.forEach(product => {
                const ecoScore = product.eco_score;
                testFramework.assertContains(ecoScore, '/10', 'Eco score should be in X/10 format');
                
                const scoreMatch = ecoScore.match(/(\d+)\/10/);
                testFramework.assert(scoreMatch, 'Should be able to extract eco score number');
                
                const score = parseInt(scoreMatch[1]);
                testFramework.assert(score >= 1 && score <= 10, 'Eco score should be between 1 and 10');
            });
            
            return true;
        });
        
        // Test 4: Product Display Functionality
        testFramework.test('Product Display Functionality', () => {
            const productDisplayDiv = document.getElementById('product-display-test');
            
            // Create product cards
            const productGrid = document.createElement('div');
            productGrid.className = 'product-grid';
            
            sampleProductData.products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                productCard.innerHTML = `
                    <div class="product-image">${product.name}</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${product.price}</div>
                    <div class="product-co2">CO₂: ${product.co2_emissions}</div>
                    <div class="product-eco-score">${product.eco_score}</div>
                    <div class="product-description">${product.description}</div>
                `;
                
                productGrid.appendChild(productCard);
            });
            
            productDisplayDiv.appendChild(productGrid);
            
            // Verify elements were created
            testFramework.assert(productGrid.children.length === sampleProductData.products.length, 'Should create correct number of product cards');
            
            return true;
        });
        
        // Test 5: CO2 Impact Analysis
        testFramework.test('CO2 Impact Analysis', () => {
            const co2AnalysisDiv = document.getElementById('co2-analysis-test');
            
            // Calculate total CO2 impact
            let totalCO2 = 0;
            let highImpactProducts = 0;
            let mediumImpactProducts = 0;
            let lowImpactProducts = 0;
            
            sampleProductData.products.forEach(product => {
                const co2Match = product.co2_emissions.match(/(\d+(?:\.\d+)?)\s*kg/i);
                if (co2Match) {
                    const co2Amount = parseFloat(co2Match[1]);
                    totalCO2 += co2Amount;
                    
                    if (co2Amount > 50) highImpactProducts++;
                    else if (co2Amount > 30) mediumImpactProducts++;
                    else lowImpactProducts++;
                }
            });
            
            co2AnalysisDiv.innerHTML = `
                <div class="test-info">
                    <h4>CO2 Impact Analysis</h4>
                    <p><strong>Total CO2 Impact:</strong> ${totalCO2.toFixed(1)} kg</p>
                    <p><strong>High Impact Products (>50kg):</strong> ${highImpactProducts}</p>
                    <p><strong>Medium Impact Products (30-50kg):</strong> ${mediumImpactProducts}</p>
                    <p><strong>Low Impact Products (<30kg):</strong> ${lowImpactProducts}</p>
                    <p><strong>Average CO2 per Product:</strong> ${(totalCO2 / sampleProductData.products.length).toFixed(1)} kg</p>
                </div>
            `;
            
            testFramework.assert(totalCO2 > 0, 'Total CO2 should be greater than 0');
            testFramework.assert(Math.abs(totalCO2 - 434.4) < 0.1, 'Total CO2 should match expected value');
            
            return true;
        });
        
        // Test 6: User Interaction Simulation
        testFramework.test('User Interaction Simulation', () => {
            const interactionDiv = document.getElementById('interaction-test');
            
            // Simulate user input
            const testInputs = [
                'show me all products',
                'what is the CO2 impact of sunglasses?',
                'find eco-friendly alternatives',
                'calculate my carbon footprint'
            ];
            
            let interactionHTML = '<h4>Simulated User Interactions</h4>';
            
            testInputs.forEach((input, index) => {
                interactionHTML += `
                    <div class="test-info">
                        <strong>Test ${index + 1}:</strong> "${input}"
                        <br><em>Expected: Should trigger appropriate response from CO2 Assistant</em>
                    </div>
                `;
            });
            
            interactionDiv.innerHTML = interactionHTML;
            
            // Test input validation
            testInputs.forEach(input => {
                testFramework.assert(input.length > 0, 'Input should not be empty');
                testFramework.assert(typeof input === 'string', 'Input should be a string');
            });
            
            return true;
        });
        
        // Test 7: Message Format Validation
        testFramework.test('Message Format Validation', () => {
            const message = sampleProductData.message;
            
            testFramework.assertContains(message, '🌱', 'Message should contain eco-friendly emoji');
            testFramework.assertContains(message, 'eco-friendly', 'Message should mention eco-friendly');
            testFramework.assertContains(message, 'products', 'Message should mention products');
            
            return true;
        });
        
        // Test 8: Responsive Design Elements
        testFramework.test('Responsive Design Elements', () => {
            // Test if key elements exist
            const container = document.querySelector('.test-container');
            testFramework.assert(container, 'Container should exist');
            
            // Test CSS classes
            const testSections = document.querySelectorAll('.test-section');
            testFramework.assert(testSections.length > 0, 'Test sections should exist');
            
            return true;
        });
        
        // Display sample products
        document.getElementById('sample-products').innerHTML = `
            <div class="test-info">
                <h4>Sample Product Data Structure</h4>
                <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto;">
${JSON.stringify(sampleProductData, null, 2)}
                </pre>
            </div>
        `;
        
        // Run all tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            testFramework.runTests();
        });
    </script>
</body>
</html>
